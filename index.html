<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Promo Shopee Hari Ini</title>

  <!-- Icon -->
  <link rel="icon" href="icon.jpg">
  <link rel="apple-touch-icon" href="icon.jpg">
  <link rel="apple-touch-icon" sizes="180x180" href="icon.jpg">

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json">

  <!-- iOS PWA meta -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Promo Shopee">

  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    .popup {
      display: none;
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.5);
      justify-content:center; align-items:center;
    }
    .popup-content {
      background:#fff; padding:20px; border-radius:10px; max-width:300px; text-align:left;
    }
    #promoBtn {
      background:#ee4d2d; color:#fff; border:none; padding:10px 20px; border-radius:5px;
      font-weight:bold; cursor:pointer; width:100%;
    }
    label { display:flex; align-items:center; margin-top:10px; cursor:pointer; }
    input[type=checkbox] { margin-right:8px; }
  </style>

  <!-- Redirect otomatis PWA Android -->
  <script>
    // Delay sedikit supaya display-mode terdeteksi
    setTimeout(() => {
      if (window.matchMedia('(display-mode: standalone)').matches) {
        window.location.replace("https://s.shopee.co.id/30hNGKMOqw");
      }
    }, 50);
  </script>

</head>
<body>

<h1>Promo Shopee Pilihan Hari Ini</h1>
<p>Belanja lewat tombol di bawah untuk mendapatkan promo resmi Shopee. Harga sama, kami mendapat komisi tanpa biaya tambahan.</p>

<!-- Popup edukasi -->
<div id="popup" class="popup">
  <div class="popup-content">
    <p>Pasang halaman ini ke layar utama supaya selalu dapat promo terbaru!</p>
    <button id="promoBtn">Pasang ke Home Screen</button>
    <label><input type="checkbox" id="dontShow"> Jangan tampilkan lagi</label>
  </div>
</div>

<script>
let deferredPrompt;
const popup = document.getElementById('popup');
const promoBtn = document.getElementById('promoBtn');
const dontShow = document.getElementById('dontShow');

// Popup hanya tampil jika user belum sembunyikan dan bukan PWA
if (!localStorage.getItem('hidePwaPopup') && !window.matchMedia('(display-mode: standalone)').matches) {

  // Tangkap event PWA sebelum install
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault(); // cegah prompt otomatis
    deferredPrompt = e;
    popup.style.display = 'flex';
  });

  // Tombol Pasang ke Home Screen
  promoBtn.addEventListener('click', async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const choice = await deferredPrompt.userChoice;
      console.log('User choice:', choice.outcome);
      deferredPrompt = null;
      popup.style.display = 'none';
    }
  });

  // Checkbox jangan tampilkan lagi
  dontShow.addEventListener('change', () => {
    if (dontShow.checked) localStorage.setItem('hidePwaPopup', 'true');
  });

}
</script>

<h2>Promo Pilihan Hari Ini</h2>
<a href="https://s.shopee.co.id/30hNGKMOqw">
  <img src="icon.jpg" alt="Promo" style="width:200px;">
</a>

</body>
</html>
